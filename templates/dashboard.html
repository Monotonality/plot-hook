{% extends 'base.html' %}

{% block page_title %}Dashboard{% endblock %}
{% block main_title %}Dashboard{% endblock %}

{% block sidebar_content %}
<div class="nav-section">
    <a href="#join-world" class="nav-item">
        <span class="nav-item-icon">🌍</span>
        <span class="nav-item-text">Join World</span>
        <span class="nav-item-arrow">▶</span>
    </a>
    
    <div class="sub-nav">
        <div class="join-form-section">
            <form class="join-form" id="joinWorldForm">
                {% csrf_token %}
                <div class="join-container">
                    <input type="text" class="join-input" name="join_code" placeholder="Enter join code..." maxlength="8" required>
                    <button type="submit" class="join-button">Join</button>
                </div>
                <div class="join-message" id="joinMessage"></div>
            </form>
        </div>
    </div>
    
    <a href="#settings" class="nav-item">
        <span class="nav-item-icon">⚙️</span>
        <span class="nav-item-text">Settings</span>
        <span class="nav-item-arrow">▶</span>
    </a>
    
    <div class="sub-nav">
        <a href="{% url 'accounts:profile_settings' %}" class="sub-nav-item">
            <span class="nav-item-icon">👤</span>
            <span class="nav-item-text">Profile Settings</span>
        </a>
        <a href="#app-preferences" class="sub-nav-item">
            <span class="nav-item-icon">🎨</span>
            <span class="nav-item-text">App Preferences</span>
        </a>
    </div>
    
    <a href="#help" class="nav-item">
        <span class="nav-item-icon">❓</span>
        <span class="nav-item-text">Help</span>
        <span class="nav-item-arrow">▶</span>
    </a>
    
    <div class="sub-nav">
        <a href="{% url 'core:landing' %}" class="sub-nav-item">
            <span class="nav-item-icon">🏠</span>
            <span class="nav-item-text">Home</span>
        </a>
        <a href="#learn-more" class="sub-nav-item">
            <span class="nav-item-icon">📚</span>
            <span class="nav-item-text">Learn More</span>
        </a>
        <a href="#support" class="sub-nav-item">
            <span class="nav-item-icon">💬</span>
            <span class="nav-item-text">Support</span>
        </a>
    </div>
</div>
{% endblock %}

{% block content %}
<h2 class="section-title">My Worlds</h2>

<!-- Dynamic CSS for world theme colors -->
<style>
{% if owned_worlds %}
    {% for world in owned_worlds %}
        .world-{{ world.id }}-pattern {
            background: linear-gradient(45deg, {{ world.theme_color }} 25%, transparent 25%), 
                        linear-gradient(-45deg, {{ world.theme_color }} 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, {{ world.theme_color }} 75%), 
                        linear-gradient(-45deg, transparent 75%, {{ world.theme_color }} 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        .world-{{ world.id }}-badge {
            background: {{ world.theme_color }};
        }
    {% endfor %}
{% endif %}
{% if member_worlds %}
    {% for world in member_worlds %}
        .world-{{ world.id }}-pattern {
            background: linear-gradient(45deg, {{ world.theme_color }} 25%, transparent 25%), 
                        linear-gradient(-45deg, {{ world.theme_color }} 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, {{ world.theme_color }} 75%), 
                        linear-gradient(-45deg, transparent 75%, {{ world.theme_color }} 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        .world-{{ world.id }}-badge {
            background: {{ world.theme_color }};
        }
    {% endfor %}
{% endif %}
</style>
{% endblock %}

{% block campaigns_grid %}
    {% if owned_worlds %}
        {% for world in owned_worlds %}
            <div class="campaign-card" onclick="window.location.href='{% url 'core:world_categories' world.id %}'" style="cursor: pointer;">
                <div class="campaign-pattern world-{{ world.id }}-pattern">
                    <div class="campaign-badge world-{{ world.id }}-badge">{{ world.name|slice:":3"|upper }}</div>
                </div>
                <div class="campaign-info">
                    <div class="campaign-title">{{ world.name }}</div>
                    <div class="campaign-stats">Creator • {{ world.owner.username }}</div>
                    <div class="campaign-actions">
                        <button class="campaign-menu" data-world-id="{{ world.id }}" data-world-name="{{ world.name }}" data-user-role="owner" onclick="event.stopPropagation();">⋮</button>
                    </div>
                </div>
            </div>
        {% endfor %}
    {% endif %}
    
    {% if member_worlds %}
        {% for world in member_worlds %}
            <div class="campaign-card" onclick="window.location.href='{% url 'core:world_categories' world.id %}'" style="cursor: pointer;">
                <div class="campaign-pattern world-{{ world.id }}-pattern">
                    <div class="campaign-badge world-{{ world.id }}-badge">{{ world.name|slice:":3"|upper }}</div>
                </div>
                <div class="campaign-info">
                    <div class="campaign-title">{{ world.name }}</div>
                    <div class="campaign-stats">Player • {{ world.owner.username }}</div>
                    <div class="campaign-actions">
                        <button class="campaign-menu" data-world-id="{{ world.id }}" data-world-name="{{ world.name }}" data-user-role="player" onclick="event.stopPropagation();">⋮</button>
                    </div>
                </div>
            </div>
        {% endfor %}
    {% endif %}
    
    {% if not owned_worlds and not member_worlds %}
        <div class="campaign-card empty-worlds-card">
            <div class="campaign-pattern pattern-blue">
                <div class="campaign-badge badge-blue">🌍</div>
            </div>
            <div class="campaign-info">
                <div class="campaign-title">No Worlds Yet</div>
                <div class="campaign-stats">Create your first world or join one to get started!</div>
            </div>
        </div>
    {% endif %}
    
    <div class="create-card">
        <div class="create-icon">+</div>
        <div class="create-text">Create New World</div>
    </div>
{% endblock %}

{% block modals %}
<!-- World Menu Dropdown -->
<div class="world-menu-dropdown" id="worldMenuDropdown">
    <div class="world-menu-header">
        <span class="world-menu-title" id="worldMenuTitle"></span>
        <button class="world-menu-close" id="worldMenuClose">×</button>
    </div>
    <div class="world-menu-actions">
        <button class="world-menu-action" id="worldMenuView">
            <span class="world-menu-icon">👁️</span>
            <span class="world-menu-text">View World</span>
        </button>
        <button class="world-menu-action danger owner-only" id="worldMenuDelete">
            <span class="world-menu-icon">🗑️</span>
            <span class="world-menu-text">Delete World</span>
        </button>
        <button class="world-menu-action danger player-only" id="worldMenuLeave">
            <span class="world-menu-icon">🚪</span>
            <span class="world-menu-text">Leave World</span>
        </button>
    </div>
</div>

<!-- Overlay for menu -->
<div class="world-menu-overlay" id="worldMenuOverlay"></div>

<!-- Create World Modal -->
<div class="create-world-modal" id="createWorldModal">
    <div class="create-world-content">
        <div class="create-world-header">
            <span class="create-world-title">Create New World</span>
            <button class="create-world-close" id="createWorldClose">×</button>
        </div>
        <form class="create-world-form" id="createWorldForm">
            {% csrf_token %}
            <div class="form-group">
                <label for="worldName" class="form-label">World Name</label>
                <input type="text" id="worldName" name="world_name" class="form-input" placeholder="Enter world name..." required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Theme Color</label>
                <div class="color-palette-container">
                    <div class="color-palette" id="colorPalette">
                        <!-- Colors will be generated by JavaScript -->
                    </div>
                    <button type="button" class="regenerate-btn" id="regenerateColors">
                        <span class="regenerate-icon">🔄</span>
                    </button>
                </div>
                <input type="hidden" id="selectedColor" name="theme_color" required>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn-secondary" id="cancelCreate">Cancel</button>
                <button type="submit" class="btn-primary">Create World</button>
            </div>
        </form>
    </div>
</div>

<!-- Overlay for create world modal -->
<div class="create-world-overlay" id="createWorldOverlay"></div>

<!-- Confirmation Modal -->
<div class="confirmation-modal" id="confirmationModal">
    <div class="confirmation-content">
        <div class="confirmation-header">
            <span class="confirmation-title">Confirm Action</span>
            <button class="confirmation-close" id="confirmationClose">×</button>
        </div>
        <div class="confirmation-body">
            <p id="confirmationMessage"></p>
        </div>
        <div class="confirmation-actions">
            <button class="btn-secondary" id="confirmationCancel">Cancel</button>
            <button class="btn-danger" id="confirmationConfirm">Confirm</button>
        </div>
    </div>
</div>

<!-- Overlay for confirmation modal -->
<div class="confirmation-overlay" id="confirmationOverlay"></div>
{% endblock %}
